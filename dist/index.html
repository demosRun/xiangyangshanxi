<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <!-- 页面的元信息 -->
  <title>{TAG_14226_TAG}</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no, email=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="white" />
  <meta name="renderer" content="webkit" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="filetype" content="1" />
  <meta name="publishedtype" content="1" />
  <meta name="pagetype" content="2" />
  <meta name="screen-orientation" content="landscape" />
  <meta name="x5-orientation" content="landscape" />
  <meta name="full-screen" content="yes" />
  <meta name="x5-fullscreen" content="true" />
  <meta name="browsermode" content="application" />
  <meta name="x5-page-mode" content="app" />

  <!-- 页面主样式文件 -->
  <link charset="utf-8" rel="stylesheet" href="./static/css/owo.core.css">

  <!-- 附属css文件 -->
  <link rel="stylesheet" href="./static/css/main.css" charset="utf-8">

</head>

<body>
  <div class="rotate-box">
    <!-- 页面[loading]-->
    <div class="loading-box scale-box page" template="loading" style="display: none;">
      <img class="ship" src="./static/resource/ship.png" o-tap="owo.go('page1////true')">
    </div>
    <!-- 页面[page1]-->
    <div class="page-1 page" template="page1" style="display: none;">
      <div class="scale-box">
        <div class="info-bar">松开即可打卡该景点</div>
        <div class="start-button" o-touchstart="playVideo" o-touchend="pauseVideo"></div>
        <video id="videoPlay" src="./static/resource/video.mp4" x5-video-orientation="portrait" preload="auto" playsinline="true" webkit-playsinline="true" x-webkit-airplay="true" x5-video-player-fullscreen="true" x5-video-player-type="h5" οnplay="onVideoLoad()" poster="./static/resource/posst.png"></video><canvas id="screenshot" width="1334" height="750"></canvas>
        <div class="show-image">
          <img src="">
        </div>
        <img class="select" src="./static/resource/select.png" o-animation="shrink" go="page2//scaleDown/scaleUpDown/true/scaleDown/scaleUp">
        <img class="enter" src="./static/resource/loading-button.png" o-animation="shrink" o-tap="play">
      </div>
    </div>
    <!-- 页面[page2]-->
    <div class="page-2 page" template="page2" style="display: none;">
      <div class="scale-box">
        <div class="share-box">
          <img class="replay-button" src="./static/resource/replay.png" o-tap="location.reload();">
          <img class="share-button" src="./static/resource/share.png" o-tap="share">
          <img class="left-button" src="./static/resource/left.png" o-tap="this.data.swiper.prev()">
          <img class="right-button" src="./static/resource/right.png" o-tap="this.data.swiper.next()">
          <div class="swiper-box">
            <img src="./static/resource/swiper-test.png">
            <img src="./static/resource/swiper-test.png">
            <img src="./static/resource/swiper-test.png">
          </div>
        </div>
      </div>
    </div>
  </div>


  <script src="http://tools.people.com.cn/libs/jquery/1.11.1/jquery-1.11.1.min.js" type="text/javascript" charset="UTF-8"></script>
  <script src="./static/js/autoScale.js" type="text/javascript" charset="UTF-8"></script>
  <script src="./static/js/main.js" type="text/javascript" charset="UTF-8"></script>
  <script src="https://cunchu.site/owo/script/TweenMax.js" type="text/javascript" charset="UTF-8"></script>
  <script src="https://cunchu.site/owo/script/three.min.js" type="text/javascript" charset="UTF-8"></script>
  <script src="./static/js/swiper3D.js" type="text/javascript" charset="UTF-8"></script>
  <!-- 框架script文件 -->
  <script src="./static/js/owo.core.js" type="text/javascript" charset="UTF-8"></script>
  <script type="text/javascript" charset="UTF-8">
    owo.script = {
      "loading": {
        "data": {
          "imgList": [""]
        },
        "show": function show() {
          var _this = this;

          // owo.go('page1')
          // document.getElementById('videoPlay').οnloadstart = function() {
          //   alert('ss')
          //   owo.go('page1')
          // }
          setTimeout(function() {
            // document.getElementsByClassName('enter')[0].style.display = 'block'
            owo.go('page1////true');
          }, 3000);
          setTimeout(function() {
            _this.query('.ship').style.left = '85%';
          }, 100);
        },
        "preloadImage": function preloadImage(src, successFn) {
          var image = new Image();
          image.src = src;

          image.onload = function() {
            successFn && successFn(src);
          };

          image.onerror = function(error) {
            successFn && successFn(src);
          };
        },
        "preloadImages": function preloadImages(srcs, doneFn, progressFn) {
          var _this2 = this;

          if (!Array.isArray(srcs)) {
            console.log('第一个参数只能是一个数组');
          } else {
            var allCount = srcs.length;
            var doneCount = 0;
            srcs.forEach(function(srcItem) {
              _this2.preloadImage(srcItem, function() {
                doneCount++;
                progressFn && progressFn(Math.ceil(100 * doneCount / allCount));

                if (doneCount === allCount) {
                  doneFn && doneFn();
                }
              });
            });
          }
        }
      },
      "page1": {
        "data": {
          "swiper": null,
          "isCut": false,
          "isPlaying": false,
          "timestamp": 1.7976931348623157e+308
        },
        "created": function created() {
          var _this3 = this;

          // 初始化Canvas
          var video = this.query('#videoPlay');
          var screenshot = this.query('#screenshot');
          screenshot.style.width = video.videoWidth + 'px';
          screenshot.style.height = video.videoHeight + 'px'; // 视频播放结束事件

          video.addEventListener('ended', function() {
            //结束
            _this3.clear();
          }, false);
        },
        "play": function play() {
          this.query('#videoPlay').play();
          this.$target.style.opacity = 0;
        },
        "playVideo": function playVideo() {
          var _this4 = this;

          // if (Date.parse(new Date()) - this.data.timestamp) {
          // }
          this.data.isPlaying = true;
          this.data.timestamp = new Date();
          this.query('#videoPlay').play();
          setTimeout(function() {
            _this4.$el.classList.add('touch');
          }, 1000);
        },
        "pauseVideo": function pauseVideo() {
          // 快结束了自动播放到完
          if (new Date() - this.data.timestamp < 1000) {
            owo.tool.toast('按住按钮不放继续浏览哦!');
          }

          if (this.query('#videoPlay').currentTime > 152) {
            return;
          }

          this.data.isPlaying = false;
          this.$el.classList.remove('touch');
          this.query('#videoPlay').pause();
          this.screenshot();
        },
        "screenshot": function screenshot() {
          var _this5 = this;

          if (this.data.isCut) return;
          this.data.isCut = true;
          var video = this.query('#videoPlay');
          var canv = this.query('#screenshot');
          var ctx1 = canv.getContext('2d');
          ctx1.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);
          var frame = ctx1.getImageData(0, 0, video.videoWidth, video.videoHeight);
          var l = frame.data.length / 4;

          for (var i = 0; i < l; i++) {
            var r = frame.data[i * 4 + 0];
            var g = frame.data[i * 4 + 1];
            var b = frame.data[i * 4 + 2];
            if (g > 100 && r > 100 && b < 43) frame.data[i * 4 + 3] = 0;
          }

          ctx1.putImageData(frame, 0, 0);
          new Audio("./static/resource/kuaimen.mp3").play(); // 截图

          var showImageBox = this.query('.show-image');
          var showImage = this.query('.show-image img');
          showImage.src = canv.toDataURL('image/png');
          showImageBox.style.display = 'block';
          setTimeout(function() {
            showImage.style.opacity = 1;
            showImageBox.style.width = '133px';
            showImageBox.style.height = '75px';
          }, 0);
          setTimeout(function() {
            showImageBox.style.left = '87%';
            showImageBox.style.bottom = '87%';
          }, 500);
          setTimeout(function() {
            showImageBox.style.opacity = 0;
          }, 1000); // 截图完毕后归位

          setTimeout(function() {
            showImageBox.style.display = '';
            showImageBox.style.width = '';
            showImageBox.style.height = '';
            showImage.style.opacity = '';
            showImageBox.style.opacity = '';
            showImageBox.style.left = '';
            showImageBox.style.bottom = '';
            _this5.data.isCut = false;
          }, 2000);
        },
        "clear": function clear() {
          var _this6 = this;

          this.data.isCut = true;
          this.$el.classList.remove('touch');
          this.query('.start-button').style.display = 'none';
          this.query('.select').style.display = 'block';
          setTimeout(function() {
            _this6.query('.select').style.opacity = 1;
          }, 100);
        },
        "share": function share() {
          owo.tool.toast('长按你喜欢的明信片分享吧!');
        }
      },
      "page2": {
        "data": {
          "swiper": null
        },
        "created": function created() {
          this.data.swiper = new swiperIt(this.query('.swiper-box'), {
            showSlider: 3,
            width: 654,
            height: 368,
            reverseTouch: true
          });
        }
      }
    };
  </script>

  <script src="./static/js/toast.js" type="text/javascript" charset="UTF-8"></script>
</body>

</html>